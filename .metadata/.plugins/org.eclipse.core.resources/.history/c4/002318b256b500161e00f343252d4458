package projet_prod_cons;

import java.util.ArrayList;

import jus.poc.prodcons.*;

public class TestProdCons  extends Simulateur {
	private Observateur obs;
	private int taille_tampon=3;
	int nb_conso=5;
	int nb_prod=10;
	Tampon tampon;
	ArrayList <Producteur> p;
	ArrayList <Consommateur> c;
	
	public TestProdCons(Observateur observateur) {
		super(observateur);
		this.obs=observateur;
		
		
		// TODO Auto-generated method stub
		//corps du programme principal
		//TODO recuperer l nombre de producteur 
		
		//TODO recuperer nombre conso
		
		
	//TODO recuperer taille du tampon 
		
		tampon = new ProdCons(taille_tampon);
		System.out.println("j'ai cree le tampon\n");
		
		Acteur prod;
		p= new ArrayList<Producteur>();// posse possiblement probleme comme initialisation
		int moyenneTempsDeTraitement= 10;//TODO a changer
		int deviationTempsDeTraitement =5;//TODO a changer
		for (int i=0;i<=nb_prod;i++){
			System.out.println("je suis la \n");
			try {
				prod=new Producteur(Producteur.Prod(), obs, moyenneTempsDeTraitement, deviationTempsDeTraitement, tampon);
				p.add(i,(Producteur)prod); 
			} catch (ControlException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			System.out.println("je suis la bis\n");
			
			System.out.println("prout\n");
		}
		System.out.println("J'ai cree les prod\n");
		c= new  ArrayList<Consommateur>();// posse possiblement probleme comme initialisation
		moyenneTempsDeTraitement= 10;//TODO a changer
		deviationTempsDeTraitement =5;//TODO a changer
		for (int i=0;i<=nb_prod;i++){
			try {
				c.add(i,new Consommateur(Consommateur.Cons(), obs, moyenneTempsDeTraitement, deviationTempsDeTraitement, tampon));
			} catch (ControlException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} 
		}
		System.out.println("j'ai cree les conso\n");
	}

	

	@Override
	protected void run() throws Exception {

		boolean b= true;
		
		for (int i=0;i<nb_prod;i++){
			p.get(i).run();
			b=b && p.get(i).isAlive();
		}
		if (b && (tampon.enAttente()>0)){
		for (int i=0;i<nb_conso;i++){
			c.get(i).run();
		}}
	}

	public static void main(String[] args) {
		new TestProdCons(new Observateur()).start();
	}
	
	
	



}
